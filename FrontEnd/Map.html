<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WayStream - Explore Destinations</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <style>
        :root {
            --primary: #0848f8;
            --primary-dark: #0639c7;
            --secondary: #ff6b6b;
            --light: #ffffff;
            --dark: #222222;
            --gray: #f5f5f5;
            --dark-gray: #888888;
            --transition: all 0.3s ease;
            --shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 8px 25px rgba(0, 0, 0, 0.2);
             /* Define navbar height variable - INCREASED */
            --navbar-height: 90px;
            --navbar-height-mobile: 70px; /* Can adjust mobile height too if desired */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            color: var(--dark);
            line-height: 1.6;
            background-color: var(--gray);
            overflow-x: hidden;
            /* Use the variable for padding */
            padding-top: var(--navbar-height);
        }

        h1, h2, h3, h4 {
            font-family: 'Playfair Display', serif;
            font-weight: 600;
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem 5%;
            background-color: rgba(8, 72, 248, 0.9);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow);
        }

        .logo {
            /* Optionally increase logo size */
            font-size: 2rem;
            font-weight: 700;
            color: var(--light);
            text-decoration: none;
            display: flex;
            align-items: center;
        }
         .logo i { margin-right: 0.6rem; color: var(--secondary); }

        .nav-links {
            display: flex;
            gap: 1.8rem; /* Slightly more gap */
            align-items: center;
        }

        .nav-links a {
            color: var(--light);
            text-decoration: none;
             /* Optionally increase font size */
            font-size: 1.1rem;
            font-weight: 500;
            transition: var(--transition);
            position: relative;
            padding: 0.5rem 0;
        }
        .nav-links a::after { content: ''; position: absolute; bottom: 0; left: 0; width: 0; height: 2px; background-color: var(--secondary); transition: var(--transition); }
        .nav-links a:hover::after { width: 100%; }
        .nav-links a:hover { color: var(--secondary); }

        .hidden { display: none !important; }

        .mobile-menu-btn { display: none; background: none; border: none; color: var(--light); font-size: 1.6rem; /* Slightly larger */ cursor: pointer; }
        /* --- End Navbar Styles --- */

        /* Hero Section */
        .map-hero {
            background: linear-gradient(rgba(8, 72, 248, 0.8), rgba(8, 72, 248, 0.8)),
                        url('https://images.unsplash.com/photo-1464037866556-6812c9d1c72e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80') no-repeat center center/cover;
            height: 40vh;
            color: var(--light);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 0 2rem;
             /* No margin-top needed due to body padding */
        }
        .map-hero h1 { font-size: 3rem; margin-bottom: 1rem; text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5); }
        .map-hero p { font-size: 1.1rem; max-width: 700px; }

        /* Main Content */
        .section { padding: 4rem 5%; }
        .section-title { text-align: center; margin-bottom: 3rem; }
        .section-title h2 { font-size: 2.5rem; color: var(--primary); margin-bottom: 0.5rem; }
        .section-title p { color: var(--dark-gray); max-width: 700px; margin: 0 auto; }

        /* Map Container */
        .map-container { position: relative; width: 100%; height: 80vh; border-radius: 10px; overflow: hidden; box-shadow: var(--shadow); background-color: var(--light); }
        #explore-map { width: 100%; height: 100%; }

        /* Login Prompt */
         #map-login-prompt { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(245, 245, 245, 0.95); z-index: 900; display: none; /* Changed initial state */ flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 2rem; }
         #map-login-prompt p { font-size: 1.3rem; color: var(--dark); margin-bottom: 1.5rem; }
         #map-login-prompt a { display: inline-block; background-color: var(--primary); color: var(--light); padding: 0.8rem 1.5rem; border-radius: 5px; text-decoration: none; font-weight: 500; transition: var(--transition); }
         #map-login-prompt a:hover { background-color: var(--primary-dark); box-shadow: var(--shadow); }

        /* Search Box */
        .search-box { position: absolute; top: 20px; left: 20px; z-index: 1000; background: var(--light); padding: 1rem 1.5rem; border-radius: 8px; box-shadow: var(--shadow-hover); width: 350px; max-width: 90%; display: none; }
        .search-box h3 { color: var(--primary-dark); margin-bottom: 1rem; font-size: 1.3rem; }
        .search-controls { display: flex; flex-direction: column; gap: 10px; }
        .search-controls input { padding: 10px 15px; border: 1px solid #ccc; border-radius: 5px; font-size: 1rem; transition: var(--transition); }
        .search-controls input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(8, 72, 248, 0.2); }

        /* Distance Label */
        .distance-label { background: rgba(0, 0, 0, 0.8); color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.85rem; font-weight: bold; text-align: center; box-shadow: 0 1px 4px rgba(0, 0, 0, 0.3); white-space: nowrap; border: 1px solid rgba(255, 255, 255, 0.5); }

        /* Footer Styles */
        footer { background-color: var(--dark); color: var(--light); padding: 4rem 5% 2rem; margin-top: 4rem;}
        .footer-content { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 3rem; margin-bottom: 3rem; }
        .footer-col h3 { font-size: 1.5rem; margin-bottom: 1.5rem; position: relative; padding-bottom: 0.5rem; }
        .footer-col h3::after { content: ''; position: absolute; bottom: 0; left: 0; width: 50px; height: 2px; background-color: var(--secondary); }
        .footer-col p { margin-bottom: 1rem; opacity: 0.8; }
        .footer-links li { margin-bottom: 0.8rem; list-style: none; }
        .footer-links a { color: white; text-decoration: none; opacity: 0.8; transition: var(--transition); }
        .footer-links a:hover { opacity: 1; color: var(--secondary); padding-left: 5px; }
        .social-links { display: flex; gap: 1rem; }
        .social-links a { display: flex; align-items: center; justify-content: center; width: 40px; height: 40px; background-color: rgba(255, 255, 255, 0.1); color: var(--light); border-radius: 50%; transition: var(--transition); }
        .social-links a:hover { background-color: var(--secondary); transform: translateY(-3px); }
        .footer-bottom { text-align: center; padding-top: 2rem; border-top: 1px solid rgba(255, 255, 255, 0.1); opacity: 0.8; }
        .newsletter-form { display: flex; }
        .newsletter-form input { flex-grow: 1; padding: 10px 15px; border: none; border-radius: 5px 0 0 5px; font-size: 1rem; }
        .newsletter-form button { padding: 10px 15px; border: none; background-color: var(--primary); color: var(--light); border-radius: 0 5px 5px 0; cursor: pointer; transition: var(--transition); font-size: 1rem; font-weight: 500;}
        .newsletter-form button:hover { background-color: var(--primary-dark); }

        /* Responsive Design */
        @media (max-width: 992px) {
            .map-hero h1 { font-size: 2.5rem; }
        }
        @media (max-width: 768px) {
             /* Adjust body padding for mobile navbar height */
             body {
                  padding-top: var(--navbar-height-mobile);
             }
             /* Adjust navbar height and padding for mobile */
             .navbar {
                 padding: 1rem 5%; /* Adjusted padding */
                 height: var(--navbar-height-mobile);
             }
             .logo { font-size: 1.6rem; }

             /* Mobile Menu Positioning based on mobile navbar height */
            .nav-links {
                position: fixed;
                top: var(--navbar-height-mobile); /* Match mobile navbar height */
                left: -100%;
                width: 100%;
                 /* Adjust height calculation */
                height: calc(100vh - var(--navbar-height-mobile));
                background-color: var(--primary-dark);
                flex-direction: column;
                align-items: center;
                justify-content: flex-start;
                padding-top: 3rem;
                gap: 2rem;
                transition: var(--transition);
                z-index: 999;
            }
            .nav-links.active { left: 0; }
            .mobile-menu-btn { display: block; z-index: 1001; }

            .map-hero { height: 35vh; }
            .map-hero h1 { font-size: 2rem; }

             .section { padding: 3rem 5%; }
             .map-container { height: 70vh; }
             .search-box { width: 90%; left: 5%; top: 15px; padding: 0.8rem 1rem;}
             .search-box h3 { font-size: 1.1rem; margin-bottom: 0.8rem;}
              #map-login-prompt p { font-size: 1.1rem;}
              #map-login-prompt a { padding: 0.7rem 1.2rem; }
         }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 1s ease forwards; opacity: 0; transform: translateY(20px);}
        .delay-1 { animation-delay: 0.2s; }
    </style>
</head>
<body>
    <!-- Header / Navbar (Dynamic) -->
    <header class="navbar">
        <a href="index.html" class="logo">
            <i class="fas fa-route"></i> WayStream
        </a>
        <button class="mobile-menu-btn" id="mobileMenuBtn">
            <i class="fas fa-bars"></i>
        </button>
        <nav class="nav-links" id="navLinks">
            <a href="index.html">Home</a>
            <a href="Review.html" class="protected-link">Reviews</a>
            <a href="Map.html">Map</a>
            <a href="Contact.html" class="protected-link">Contact</a>
            <a href="Login.html" class="login-btn" id="loginLink">Login</a>
            <a href="Register.html" class="login-btn" id="registerLink">Register</a>
            <a href="#" class="login-btn hidden" id="logoutLink">Logout</a>
        </nav>
    </header>

    <!-- Optional Hero Section -->
    <section class="map-hero fade-in">
        <h1>Explore Your World</h1>
        <p>Find routes, distances, and discover amazing places.</p>
    </section>

    <!-- Main Content -->
    <main>
        <!-- Map Section -->
        <section class="section">
            <div class="section-title fade-in delay-1">
                <h2>Interactive Travel Map</h2>
                <p>Enter start and destination points to see the route and distance.</p>
            </div>

            <div class="map-container fade-in delay-1">
                 <!-- Login Prompt Overlay -->
                 <div id="map-login-prompt">
                     <p>Please log in to access the interactive map features.</p>
                     <a href="Login.html">Go to Login</a>
                 </div>
                <!-- Map Div -->
                <div id="explore-map"></div>
                <!-- Search Box -->
                <div class="search-box" id="mapSearchBox">
                    <h3>Plan Your Route</h3>
                    <div class="search-controls">
                        <label for="start-input" class="hidden">Start Location</label>
                        <input type="text" id="start-input" placeholder="Enter start location..." aria-label="Start Location"/>
                        <label for="destination-input" class="hidden">Destination Location</label>
                        <input type="text" id="destination-input" placeholder="Enter destination..." aria-label="Destination Location"/>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
             <div class="footer-col">
                <h3>WayStream</h3>
                <p>Your guide to seamless travel planning and exploration.</p>
                 <div class="social-links">
                    <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                    <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                    <a href="#" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                </div>
            </div>
            <div class="footer-col">
                <h3>Quick Links</h3>
                <ul class="footer-links">
                     <li><a href="index.html">Home</a></li>
                     <li><a href="Review.html" class="protected-link">Reviews</a></li>
                     <li><a href="Map.html">Map</a></li>
                     <li><a href="Contact.html" class="protected-link">Contact</a></li>
                     <li><a href="Register.html" id="footerRegisterLink">Login/Register</a></li>
                     <li><a href="#" class="hidden" id="footerLogoutLink">Logout</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h3>Newsletter</h3>
                <p>Subscribe for travel tips and updates.</p>
                <form class="newsletter-form" id="newsletterForm">
                     <label for="newsletter-email" class="hidden">Email</label>
                    <input type="email" id="newsletter-email" placeholder="Your Email" required>
                    <button type="submit">Subscribe</button>
                </form>
            </div>
        </div>
        <div class="footer-bottom">
             <p>© <span id="currentYear"></span> WayStream Travel. All Rights Reserved.</p>
        </div>
    </footer>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Main Script (No changes needed from previous version) -->
    <script>
        // --- UI Elements ---
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const navLinksContainer = document.getElementById('navLinks');
        const loginLink = document.getElementById('loginLink');
        const registerLink = document.getElementById('registerLink');
        const logoutLink = document.getElementById('logoutLink');
        const footerLoginLink = document.getElementById('footerLoginLink');
        const footerRegisterLink = document.getElementById('footerRegisterLink');
        const footerLogoutLink = document.getElementById('footerLogoutLink');
        const mapContainer = document.getElementById('explore-map');
        const mapLoginPrompt = document.getElementById('map-login-prompt');
        const mapSearchBox = document.getElementById('mapSearchBox');
        const startInput = document.getElementById('start-input');
        const destinationInput = document.getElementById('destination-input');

        // --- Core Login Functions ---
        function isLoggedIn() { return localStorage.getItem('waystreamLoggedIn') === 'true'; }
        function updateNavUI() {
            const loggedIn = isLoggedIn();
            loginLink?.classList.toggle('hidden', loggedIn);
            registerLink?.classList.toggle('hidden', loggedIn);
            logoutLink?.classList.toggle('hidden', !loggedIn);
            footerLoginLink?.classList.toggle('hidden', loggedIn);
            footerRegisterLink?.classList.toggle('hidden', loggedIn);
            footerLogoutLink?.classList.toggle('hidden', !loggedIn);
        }
        function handleProtectedAction(event, alertMessage = 'Please log in to access this feature.') {
            if (!isLoggedIn()) {
                if (event) event.preventDefault();
                alert(alertMessage);
                return false;
            }
            return true;
        }
        function toggleMobileMenu() {
            navLinksContainer.classList.toggle('active');
            mobileMenuBtn.innerHTML = navLinksContainer.classList.contains('active') ? '<i class="fas fa-times"></i>' : '<i class="fas fa-bars"></i>';
        }

        // --- Map Specific Variables ---
        let map = null; let startMarker = null; let endMarker = null; let routeLine = null; let distanceMarker = null;

        // --- Map Initialization and Logic (Conditional) ---
        function initializeMapFeatures() {
            map = L.map('explore-map').setView([20.5937, 78.9629], 5);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors' }).addTo(map);
            startInput?.addEventListener('change', () => searchLocation('start-input', 'start'));
            destinationInput?.addEventListener('change', () => searchLocation('destination-input', 'destination'));
        }
        function clearMapLayers() {
             if (startMarker) map?.removeLayer(startMarker); if (endMarker) map?.removeLayer(endMarker); if (routeLine) map?.removeLayer(routeLine); if (distanceMarker) map?.removeLayer(distanceMarker);
             startMarker = null; endMarker = null; routeLine = null; distanceMarker = null;
         }
        function searchLocation(inputId, markerType) {
             if (!isLoggedIn() || !map) return;
            const query = document.getElementById(inputId).value.trim(); if (!query) return;
            document.getElementById(inputId).style.opacity = '0.7';
            fetch(`https://nominatim.openstreetmap.org/search?format=json&limit=1&q=${encodeURIComponent(query)}`)
                .then(response => response.json()).then(data => {
                    if (data.length === 0) { alert(`No results found for "${query}". Please try a different ${markerType} location.`); return; }
                    const latlng = [parseFloat(data[0].lat), parseFloat(data[0].lon)]; const displayName = data[0].display_name;
                    if (markerType === 'start') { if (startMarker) map.removeLayer(startMarker); startMarker = L.marker(latlng).addTo(map).bindPopup(`<b>Start:</b><br>${displayName}`).openPopup(); }
                    else if (markerType === 'destination') { if (endMarker) map.removeLayer(endMarker); endMarker = L.marker(latlng).addTo(map).bindPopup(`<b>Destination:</b><br>${displayName}`).openPopup(); }
                    if (!startMarker || !endMarker) { map.setView(latlng, 10); } checkAndDrawRoute();
                }).catch(error => { console.error('Error fetching location:', error); alert(`Failed to search for ${markerType} location. Check connection or try again.`); })
                 .finally(() => { document.getElementById(inputId).style.opacity = '1'; });
        }
        function checkAndDrawRoute() {
             if (!isLoggedIn() || !map) return;
            if (startMarker && endMarker) {
                const startLatLng = startMarker.getLatLng(); const endLatLng = endMarker.getLatLng();
                if (routeLine) map.removeLayer(routeLine); if (distanceMarker) map.removeLayer(distanceMarker);
                routeLine = L.polyline([startLatLng, endLatLng], { color: 'var(--primary)', weight: 5, opacity: 0.8 }).addTo(map);
                const distanceInKm = (map.distance(startLatLng, endLatLng) / 1000).toFixed(1);
                const midLat = (startLatLng.lat + endLatLng.lat) / 2; const midLng = (startLatLng.lng + endLatLng.lng) / 2;
                 const distanceLabelIcon = L.divIcon({ html: `<div class="distance-label">${distanceInKm} km</div>`, className: '', iconSize: null });
                distanceMarker = L.marker([midLat, midLng], { icon: distanceLabelIcon, interactive: false }).addTo(map);
                map.fitBounds(routeLine.getBounds().pad(0.1));
            }
        }

        // --- Event Listeners ---
        if (mobileMenuBtn) mobileMenuBtn.addEventListener('click', toggleMobileMenu);
         [logoutLink, footerLogoutLink].forEach(link => { if (link) { link.addEventListener('click', (e) => { e.preventDefault(); localStorage.removeItem('waystreamLoggedIn'); localStorage.removeItem('waystreamUsername'); alert('You have been logged out.'); window.location.href = 'index.html'; }); } });
         document.querySelectorAll('.protected-link').forEach(link => { link.addEventListener('click', (e) => { handleProtectedAction(e); }); });
         const newsletterForm = document.getElementById('newsletterForm'); if (newsletterForm) { newsletterForm.addEventListener('submit', (e) => { e.preventDefault(); alert('Thank you for subscribing! (Simulated)'); newsletterForm.reset(); }); }
         const currentYearSpan = document.getElementById('currentYear'); if (currentYearSpan) { currentYearSpan.textContent = new Date().getFullYear(); }

        // --- Run on Page Load ---
        document.addEventListener('DOMContentLoaded', () => {
            updateNavUI();
            if (isLoggedIn()) {
                mapLoginPrompt.style.display = 'none'; mapSearchBox.style.display = 'block'; initializeMapFeatures();
            } else {
                mapLoginPrompt.style.display = 'flex'; mapSearchBox.style.display = 'none';
            }
        });
    </script>
</body>
</html>
